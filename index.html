<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Po√©zine</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inria+Serif:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tiny.css@0.12/dist/tiny.css">
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css"> -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        * {
            font-family: "Inria Serif";
            scroll-behavior: smooth;
        }

        a {
            color: var(--text-main);
            font-weight: 500;
            text-decoration: none;
        }

        body {
            margin-top: 0 !important;
            display: flex;
            flex-direction: row;
            gap: 2em;
            justify-content: center;
        }

        body:has(.focus) {
            justify-content: flex-start;
        }

        nav,
        .main {
            padding-top: 0 !important;
        }

        nav {
            display: block;
            text-align: right;
            min-width: 25ch;
            width: 35%;
            background-color: var(--background-body);
        }

        .main div {
            min-width: 50ch;
        }

        section>p:first-child {
            padding-top: 3em;
        }

        .hidden {
            display: none
        }

        .hidden:target {
            display: block;
        }

        #mymenu {
            /* width: 25ch; */
            position: sticky;
            padding-top: 1em;
            top: 0;
            color-scheme: dark;
            background-color: var(--background-body);
        }

        p {
            padding: 0 1em;
            line-height: 1.5em;
        }

        #mymenu:not(:has(.focus)) {
            text-align: center;
        }

        /* If nav has a poemtitle currently focused, but nav is not currently hovered, then poemtiles not in focus are hidden */
        /* nav:has(.focus):not(:hover) .poemtitle:not(.focus) {
            display: none;
        }

        nav:has(.focus):hover .poemtitle:not(.focus) {
            display: block;
            opacity: 0.4
        } */

        /* collapsed state */
nav:has(.focus):not(:hover):not(:focus-within)
.poemtitle:not(.focus) {
    display: none;
}

/* expanded state */
nav:has(.focus):is(:hover, :focus-within)
.poemtitle:not(.focus) {
    display: block;
    opacity: 0.4;
}

        .poemtitle {
            font-size: 1.1rem;
            display: block;

            &:hover {
                font-style: italic;
            }
        }

        @media (max-width: 80ch) {
                 section>p:first-child {
            padding-top: 0;
        }

            nav {
                text-align: center;
                position: sticky;
                top: 0;
            }

            #mymenu {
                position: relative;
                width: 100vw;
                padding-bottom: 1em;
            }

            body {
                flex-direction: column;
                max-width: 100vw;
                gap: 0;
            }
        }

        @media(pointer: coarse) {
            #mymenu:focus-within .poemtitle{
                display: block;
            }
            #mymenu {
                position: static;
            }
        }
    </style>
</head>
<body>
    <nav>
        <div id="mymenu"></div>
    </nav>
    <div class="main">
        <!-- <div id="litanie">Loading...</div>
        <div id="ciel-de-traine">Loading...</div>
        <div id="jardin-de-ville">Loading...</div>
        <div id="architecture-moderne">Loading...</div> -->
    </div>
    <script src="
https://cdn.jsdelivr.net/npm/umbrellajs@3.3.3/umbrella.min.js
"></script>
    <script>
        [
            { file: "Ciel de traine", id: "ciel-de-traine" },
            { file: "Architecture moderne", id: "architecture-moderne" },
            { file: "Jardin de ville", id: "jardin-de-ville" },
            { file: "Litanie des objets perdus", id: "litanie" },
        ].forEach(({ file, id }) => {
            fetch(file + '.md')
                .then(res => res.text())
                .then(md => {
                    u("#mymenu").append(u(
                        `<a 
                            class="poemtitle" 
                            href=${"#" + id}
                        >
                            ${file}
                        </a>`
                    ))
                    u(".main").append(`<section id=${id}></section>`)
                    u("#" + id).html(marked.parse(md));
                    u("#" + id).addClass("hidden");

                    u(".poemtitle").each(el => {
                        u(el).on('click', (e) => {
                            changeFocus(u(el), ".poemtitle");
                        });
                    });
                })
                .catch(error => {
                    u("#" + id).html(`<div class="error">Error loading Notes.md: ${error.message}</div>`);
                });
        })

        function changeFocus(target, group) {
            u(group).each(el => { u(el).removeClass("focus") })
            u(target).addClass("focus")
        }

    </script>
</body>
</html>